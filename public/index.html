<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelFinder Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .custom-popup .leaflet-popup-content {
            margin: 15px;
            font-size: 14px;
            line-height: 1.6;
        }
        .custom-popup b {
            color: #1f2937; /* text-gray-800 */
        }
        /* Custom scrollbar for a polished light look */
        #destination-list::-webkit-scrollbar { width: 6px; }
        #destination-list::-webkit-scrollbar-track { background: #f1f5f9; } /* slate-100 */
        #destination-list::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; } /* gray-300 */
        #destination-list::-webkit-scrollbar-thumb:hover { background: #9ca3af; } /* gray-400 */

        /* Skeleton loader animation */
        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }
        .skeleton-loader::after {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            transform: translateX(-100%);
            background-image: linear-gradient(90deg, rgba(255,255,255, 0) 0, rgba(0,0,0, 0.03) 20%, rgba(0,0,0, 0.06) 60%, rgba(255,255,255, 0));
            animation: shimmer 2s infinite;
            content: '';
        }

        /* Marker pulse animation on hover */
        .marker-pulse { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="bg-slate-50 flex flex-col md:flex-row h-screen overflow-hidden antialiased">

    <!-- Left Panel -->
    <aside class="w-full md:w-[380px] bg-rose-50 border-r border-slate-200 p-6 flex flex-col h-full">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-pink-700 via-pink-500 to-blue-800">🛫 𝓣𝓻𝓪𝓿𝓮𝓵 </h1>
             <h2 class="inline-block ml-[4.2rem] bg-clip-text text-transparent bg-gradient-to-r from-blue-500 via-rose-500 to-pink-900">𝐹𝒾𝓃𝒹𝑒𝓇 </h2>
            <p class="text-slate-500 text-sm mt-1">Plan Less ⏳ Travel More 🌍</p>
        </header>

        <!-- Search Form -->
        <div class="flex items-center space-x-2">
            <div class="relative flex-grow">
                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                     <svg class="h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V6.375c0-.621.504-1.125 1.125-1.125h.375m16.5 0h.375a1.125 1.125 0 011.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m0 0h-.375a1.125 1.125 0 01-1.125-1.125V6.375c0-.621.504-1.125 1.125-1.125h.375M3 8.25v1.5m18-1.5v1.5m-12-1.5h.008v.008H9v-.008zm3 0h.008v.008H12v-.008zm3 0h.008v.008H15v-.008zm-3 4.5h.008v.008H12v-.008zm3 0h.008v.008H15v-.008zm-3 4.5h.008v.008H12v-.008zm3 0h.008v.008H15v-.008z" /></svg>
                </div>
                <input id="budget-input" type="number" placeholder="Enter budget" class="bg-slate-100 border border-slate-300 text-slate-900 text-sm rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500 block w-full pl-12 p-3.5 transition duration-300 ease-in-out">
            </div>
            <select id="currency-select" class="bg-slate-100 border border-slate-300 text-slate-900 text-sm rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500 block p-3.5">
                <option>USD</option><option>EUR</option><option>GBP</option><option>JPY</option><option>CAD</option><option>AUD</option><option>INR</option>
            </select>
        </div>

        <button id="find-button" class="w-full mt-4 text-white font-semibold bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 focus:outline-none focus:ring-4 focus:ring-pink-300 rounded-xl text-md px-5 py-3.5 text-center transition-all transform hover:scale-[1.03] shadow-lg hover:shadow-xl duration-300 ease-in-out">
            Find Destinations
        </button>

        <div class="my-6 border-t border-slate-200"></div>

        <div id="destination-list-container" class="flex-grow overflow-hidden relative">
            <div id="destination-list" class="absolute inset-0 overflow-y-auto pr-2 space-y-4">
                <p id="placeholder-text" class="text-center text-slate-400 mt-16 px-4">Enter your budget to discover your next adventure!</p>
            </div>
        </div>
    </aside>

    <!-- Map Panel -->
    <main class="flex-grow h-full">
        <div id="map" class="w-full h-full"></div>
    </main>
    
    <script>
        const map = L.map('map', { zoomControl: false }).setView([20, 0], 2.5);
        L.control.zoom({ position: 'topright' }).addTo(map);
        let markers = {}; // Use an object to store markers by name
        let markersLayer = L.layerGroup().addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        const findButton = document.getElementById('find-button');
        const budgetInput = document.getElementById('budget-input');
        const currencySelect = document.getElementById('currency-select');
        const destinationList = document.getElementById('destination-list');
        const placeholderText = document.getElementById('placeholder-text');

        const showSkeletonLoaders = () => {
            placeholderText.style.display = 'none';
            let loaderHTML = '';
            for (let i = 0; i < 4; i++) {
                loaderHTML += `
                    <div class="bg-white border border-slate-200 rounded-2xl p-4 shadow-sm relative overflow-hidden">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 rounded-full bg-slate-200 skeleton-loader"></div>
                            <div>
                                <div class="h-5 w-32 bg-slate-200 rounded skeleton-loader mb-2"></div>
                                <div class="h-4 w-24 bg-slate-200 rounded skeleton-loader"></div>
                            </div>
                        </div>
                        <div class="mt-4 space-y-2">
                            <div class="h-4 w-full bg-slate-200 rounded skeleton-loader"></div>
                            <div class="h-4 w-3/4 bg-slate-200 rounded skeleton-loader"></div>
                        </div>
                    </div>`;
            }
            destinationList.innerHTML = loaderHTML;
        };
        
        const fetchDestinations = async () => {
            const budget = budgetInput.value;
            const currency = currencySelect.value;
            if (!budget) {
                destinationList.innerHTML = `<p class="text-center text-red-500 mt-16 px-4">Please enter a budget to begin your search.</p>`;
                placeholderText.style.display = 'none';
                return;
            }

            showSkeletonLoaders();
            markersLayer.clearLayers();
            markers = {}; // Reset markers

            try {
                // This relative path is crucial for both local and deployed environments.
                const response = await fetch(`/api/destinations?budget=${budget}&currency=${currency}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const destinations = await response.json();
                
                destinationList.innerHTML = '';
                
                if (destinations.length > 0) {
                    destinations.forEach(dest => {
                        const card = document.createElement('div');
                        card.className = 'bg-white border border-slate-200 rounded-2xl p-4 shadow-sm hover:shadow-lg hover:border-rose-300 transition-all duration-300 ease-in-out cursor-pointer transform hover:-translate-y-1';
                        card.innerHTML = `
                            <div class="flex items-center space-x-4">
                                <img src="${dest.flag}" alt="${dest.name} flag" class="w-12 h-12 object-cover rounded-full shadow-md border border-slate-100">
                                <div>
                                    <h3 class="font-bold text-lg text-slate-800">${dest.name}</h3>
                                    <p class="text-sm text-slate-500">${dest.capital}</p>
                                </div>
                            </div>
                            <div class="mt-4 space-y-2 text-sm text-slate-600">
                                <div class="flex items-center"><svg class="h-4 w-4 mr-2 text-rose-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7-5 0 3.75 3.75 0 017.5 0z" /></svg><strong>Weather:</strong>&nbsp;${Math.round(dest.weather.temp)}°C, ${dest.weather.description}</div>
                                <div class="flex items-start"><svg class="h-4 w-4 mr-2 text-rose-500 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21l-8.5-8.5a5 5 0 117-7l1.5 1.5 1.5-1.5a5 5 0 117 7L12 21z" /></svg><div><strong>Top Sights:</strong>&nbsp;${dest.attractions.join(', ')}</div></div>
                            </div>
                        `;
                        
                        card.addEventListener('mouseenter', () => markers[dest.name]?.getElement()?.classList.add('marker-pulse'));
                        card.addEventListener('mouseleave', () => markers[dest.name]?.getElement()?.classList.remove('marker-pulse'));
                        card.addEventListener('click', () => map.flyTo(dest.latlng, 6, { animate: true, duration: 1 }));
                        
                        destinationList.appendChild(card);

                        const popupContent = `<div class="custom-popup"><b>${dest.name}</b><br>${dest.capital}<br>Temp: ${Math.round(dest.weather.temp)}°C</div>`;
                        const marker = L.marker(dest.latlng).addTo(markersLayer).bindPopup(popupContent);
                        markers[dest.name] = marker; // Store marker for hover interaction
                    });
                } else {
                    destinationList.innerHTML = `<p class="text-center text-slate-500 mt-16 px-4">No destinations found. Our AI is stumped! Please try a different budget.</p>`;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                destinationList.innerHTML = `<p class="text-center text-red-500 mt-16 px-4">Could not fetch destinations. Please ensure the backend server is running and accessible.</p>`;
            }
        };

        findButton.addEventListener('click', fetchDestinations);
        budgetInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                fetchDestinations();
            }
        });
    </script>
</body>
</html>

